<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold War Life Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #eee;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255, 255, 255, 0.03) 2px,
                rgba(255, 255, 255, 0.03) 4px
            );
            pointer-events: none;
            animation: scanlines 8s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
            animation: glowPulse 2s ease-in-out infinite alternate, floatTitle 3s ease-in-out infinite;
            transform-origin: center;
        }

        @keyframes glowPulse {
            from { 
                text-shadow: 0 0 10px rgba(255, 107, 107, 0.5), 0 0 20px rgba(255, 107, 107, 0.3);
                transform: scale(1);
            }
            to { 
                text-shadow: 0 0 20px rgba(255, 107, 107, 0.8), 0 0 40px rgba(255, 107, 107, 0.4);
                transform: scale(1.02);
            }
        }

        @keyframes floatTitle {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .subtitle {
            text-align: center;
            color: #4ecdc4;
            margin-bottom: 40px;
            font-size: 0.9em;
            animation: fadeInUp 1s ease-out 0.3s both;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            animation: slideInScale 0.6s ease-out;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .form-section:hover {
            box-shadow: 0 12px 48px rgba(78, 205, 196, 0.2);
            transform: translateY(-2px);
        }

        @keyframes slideInScale {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .form-group {
            margin-bottom: 25px;
            animation: fadeInRight 0.5s ease-out both;
        }

        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }
        .form-group:nth-child(5) { animation-delay: 0.5s; }
        .form-group:nth-child(6) { animation-delay: 0.6s; }
        .form-group:nth-child(7) { animation-delay: 0.7s; }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4ecdc4;
            font-weight: bold;
            font-size: 0.95em;
            text-shadow: 0 0 5px rgba(78, 205, 196, 0.3);
            transition: all 0.3s ease;
        }

        .form-group:hover label {
            color: #5fe7dd;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }

        select, input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        select:hover, input:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #4ecdc4;
            transform: translateX(5px);
        }

        select:focus, input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
            transform: scale(1.02);
        }

        option {
            background: #16213e;
            color: #fff;
        }

        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.5s ease-out 0.8s both;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.5);
        }

        button:active {
            transform: translateY(-1px);
        }

        .results {
            display: none;
        }

        .decision-point {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            animation: pulseGold 2s ease-in-out infinite;
        }

        @keyframes pulseGold {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.6); }
        }

        .decision-prompt {
            color: #ffd700;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .choice-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.3) 0%, rgba(78, 205, 196, 0.1) 100%);
            border: 1px solid #4ecdc4;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }

        .choice-btn:hover {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.5) 0%, rgba(78, 205, 196, 0.3) 100%);
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.4);
        }

        .timeline-entry {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #4ecdc4;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            opacity: 0;
            transform: translateX(-50px) rotateY(-10deg);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .timeline-entry:hover {
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 8px 30px rgba(78, 205, 196, 0.3);
        }

        .timeline-entry.visible {
            animation: slideInRotate 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes slideInRotate {
            from {
                opacity: 0;
                transform: translateX(-50px) rotateY(-10deg);
            }
            to {
                opacity: 1;
                transform: translateX(0) rotateY(0);
            }
        }

        .timeline-entry:nth-child(even) {
            border-left-color: #ff6b6b;
        }

        .year-header {
            font-size: 1.4em;
            color: #ff6b6b;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
            animation: numberFlicker 3s ease-in-out infinite;
        }

        @keyframes numberFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .age-info {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-style: italic;
            text-shadow: 0 0 8px rgba(78, 205, 196, 0.3);
        }

        .life-event {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .life-event.typing::after {
            content: '▊';
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }

        .life-event.typed::after {
            content: '';
        }
        
        .historical-text.typing::after {
            content: '▊';
            animation: blink 1s step-end infinite;
            margin-left: 2px;
        }

        .historical-text.typed::after {
            content: '';
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .historical-event {
            background: rgba(255, 107, 107, 0.15);
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            border-left: 3px solid #ff6b6b;
            opacity: 0;
            transform: scaleY(0);
            transform-origin: top;
        }

        .historical-event.visible {
            animation: expandDown 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes expandDown {
            from {
                opacity: 0;
                transform: scaleY(0);
            }
            to {
                opacity: 1;
                transform: scaleY(1);
            }
        }

        .character-summary {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(255, 107, 107, 0.2) 100%);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: scale(0.8) rotateX(-20deg);
        }

        .character-summary.visible {
            animation: popIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.8) rotateX(-20deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotateX(0);
            }
        }

        .reset-btn {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a8a0 100%);
            margin-top: 30px;
            opacity: 0;
        }

        .reset-btn.visible {
            animation: bounceIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(50px);
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #4ecdc4;
        }

        .loading::after {
            content: '...';
            animation: loadingDots 1.5s steps(4) infinite;
        }

        @keyframes loadingDots {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }

        .consequence {
            background: rgba(255, 215, 0, 0.1);
            border-left: 3px solid #ffd700;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            font-style: italic;
            color: #ffd700;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .timeline-entry:hover .year-header {
            animation: shake 0.5s ease-in-out;
        }

        .death-reason {
            color: rgba(255, 180, 180, 0.85);
            font-size: 0.95em;
            font-family: 'Courier New', monospace;
            margin-top: 16px;
            font-style: italic;
            letter-spacing: 0.03em;
            line-height: 1.6;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            opacity: 0;
            transition: opacity 1s ease-in-out 0.4s;
        }

        .death-reason.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚛ COLD WAR LIFE SIMULATOR ⚛</h1>
        <p class="subtitle">Experience life during the Space Race & Cuban Missile Crisis</p>

        <div id="formSection" class="form-section">
            <div class="form-group">
                <label for="characterName">Character Name</label>
                <input type="text" id="characterName" placeholder="Enter your character's name" value="John">
            </div>

            <div class="form-group">
                <label for="birthYear">Birth Year (1930-1965)</label>
                <select id="birthYear">
                    <option value="1930">1930</option>
                    <option value="1935">1935</option>
                    <option value="1940">1940</option>
                    <option value="1945">1945</option>
                    <option value="1950" selected>1950</option>
                    <option value="1955">1955</option>
                    <option value="1960">1960</option>
                    <option value="1965">1965</option>
                </select>
            </div>

            <div class="form-group">
                <label for="nationality">Nationality</label>
                <select id="nationality">
                    <option value="american">American</option>
                    <option value="soviet">Soviet</option>
                    <option value="british">British</option>
                    <option value="cuban">Cuban</option>
                </select>
            </div>

            <div class="form-group">
                <label for="job">Occupation</label>
                <select id="job">
                    <option value="engineer">Aerospace Engineer</option>
                    <option value="scientist">Nuclear Scientist</option>
                    <option value="pilot">Military Pilot</option>
                    <option value="diplomat">Diplomat</option>
                    <option value="factory">Factory Worker</option>
                    <option value="teacher">School Teacher</option>
                    <option value="journalist">Journalist</option>
                    <option value="farmer">Farmer</option>
                </select>
            </div>

            <div class="form-group">
                <label for="socialStatus">Social Status</label>
                <select id="socialStatus">
                    <option value="elite">Elite (Government/Military Leadership)</option>
                    <option value="upper">Upper Class (Professionals)</option>
                    <option value="middle">Middle Class</option>
                    <option value="working">Working Class</option>
                    <option value="poor">Lower Class</option>
                </select>
            </div>

            <div class="form-group">
                <label for="location">Location Type</label>
                <select id="location">
                    <option value="urban">Major City</option>
                    <option value="suburban">Suburban Area</option>
                    <option value="rural">Rural Area</option>
                    <option value="military">Military Base</option>
                </select>
            </div>

            <button onclick="generateLife()">Generate Life Story</button>
        </div>

        <div id="results" class="results"></div>
    </div>

    <script>
        const historicalEvents = {
            1957: "Sputnik 1 launches — the Space Race begins.",
            1961: "Yuri Gagarin orbits Earth; Berlin Wall follows that year.",
            1962: "Cuban Missile Crisis — the world teeters on nuclear brink.",
            1963: "Assassination of JFK shocks the nation.",
            1968: "Year of worldwide unrest and major protests.",
            1969: "Apollo 11: humans walk on the Moon."
        };

        let allTypingTimeouts = [];
        let characterChoices = {};
        let generationPaused = false;
        let characterName = '';

        // Auto-scroll to the bottom of new content smoothly
        function scrollToLatest(element) {
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'end' });
            } else {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }
        }

        function typeText(element, text, speed = 6) {
            return new Promise((resolve) => {
                element.classList.add('typing');
                let i = 0;
                
                function type() {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                        // Scroll periodically while typing so content stays in view
                        if (i % 40 === 0) scrollToLatest(element);
                        const timeout = setTimeout(type, speed);
                        allTypingTimeouts.push(timeout);
                    } else {
                        element.classList.remove('typing');
                        element.classList.add('typed');
                        resolve();
                    }
                }
                type();
            });
        }

        function pauseGeneration() {
            return new Promise((resolve) => {
                const checkPause = setInterval(() => {
                    if (!generationPaused) {
                        clearInterval(checkPause);
                        resolve();
                    }
                }, 100);
            });
        }

        function createDecisionPoint(year, prompt, choices, container) {
            return new Promise((resolve) => {
                generationPaused = true;
                
                const decisionDiv = document.createElement('div');
                decisionDiv.className = 'decision-point';
                decisionDiv.innerHTML = `
                    <div class="decision-prompt">⚡ CRITICAL DECISION (${year}) ⚡</div>
                    <p style="margin-bottom: 15px;">${prompt}</p>
                    <div id="choices-${year}"></div>
                `;
                
                container.appendChild(decisionDiv);
                scrollToLatest(decisionDiv);
                
                const choicesContainer = decisionDiv.querySelector(`#choices-${year}`);
                
                let autoResolveTimer = setTimeout(() => {
                    if (generationPaused && choices && choices[0]) {
                        const choice = choices[0];
                        characterChoices[year] = choice.value;
                        decisionDiv.style.opacity = '0.5';
                        decisionDiv.style.pointerEvents = 'none';
                        const consequence = document.createElement('div');
                        consequence.className = 'consequence';
                        consequence.textContent = `Auto-chosen: ${choice.text}`;
                        decisionDiv.appendChild(consequence);
                        generationPaused = false;
                        resolve(choice.value);
                    }
                }, 5000);

                choices.forEach((choice, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.textContent = `${String.fromCharCode(65 + index)}. ${choice.text}`;
                    btn.onclick = () => {
                        clearTimeout(autoResolveTimer);
                        characterChoices[year] = choice.value;
                        decisionDiv.style.opacity = '0.5';
                        decisionDiv.style.pointerEvents = 'none';
                        
                        const consequence = document.createElement('div');
                        consequence.className = 'consequence';
                        consequence.textContent = `You chose: ${choice.text}`;
                        decisionDiv.appendChild(consequence);
                        
                        generationPaused = false;
                        resolve(choice.value);
                    };
                    choicesContainer.appendChild(btn);
                });
                
                decisionDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        }

        function shouldShowHistoricalContext(age, year, hasSpecialEvent) {
            if (age % 10 === 0 && age > 0) return true;
            if (hasSpecialEvent) return true;
            return false;
        }

        function hasSignificantEvent(year, age, nationality, job) {
            if (year === 1957 && job === 'engineer') return true;
            if (year === 1961 && (job === 'pilot' || age >= 16)) return true;
            if (year === 1962) return true;
            if (year === 1963 && nationality === 'american') return true;
            if (year === 1969 && job === 'engineer') return true;
            return false;
        }

        function getDeathReason(nationality, job, socialStatus, location, birthYear, choices) {
            const deathAge = 1975 - birthYear; // rough end-of-simulation age
            const lastYear = 1969;

            // Choice-influenced deaths
            if (choices[1962] === 'volunteer_recon') {
                return `Cause of death: Shot down over eastern Cuba on October 27, 1962 — the most dangerous day in human history. An SA-2 surface-to-air missile found your U-2 near Banes. You were the only combat fatality of the Cuban Missile Crisis. Age ${lastYear - birthYear}.`;
            }
            if (choices[1962] === 'leak') {
                return `Cause of death: Found dead in a hotel room in 1964 under suspicious circumstances, shortly after leaking classified intelligence to the press. The official report said heart failure. Age ${1964 - birthYear}.`;
            }
            if (choices[1965] === 'enlist') {
                return `Cause of death: Killed in action in the Mekong Delta, Vietnam, 1967. A land mine on a jungle patrol. Your name would be etched into the Vietnam Veterans Memorial wall in Washington when it was dedicated in 1982. Age ${1967 - birthYear}.`;
            }
            if (choices[1965] === 'flee' && nationality === 'american') {
                return `Cause of death: Lived in exile in Montreal until a car accident in 1971. You never did go home. Age ${1971 - birthYear}.`;
            }
            if (choices[1961] === 'escape' && nationality === 'cuban') {
                return `Cause of death: Drowned attempting the Florida Straits crossing in August 1961. The raft didn't hold. Age ${1961 - birthYear}.`;
            }
            if (choices[1961] === 'help' && nationality === 'cuban') {
                return `Cause of death: Arrested for counter-revolutionary activity in 1965 and sentenced to a labor camp. You did not survive the conditions. Age ${1965 - birthYear}.`;
            }
            if (choices[1968] === 'protest') {
                return `Cause of death: Struck by a vehicle during a protest in Chicago, 1968. The driver was never charged. Age ${1968 - birthYear}.`;
            }

            // Job-based deaths
            if (job === 'pilot' && nationality === 'american') {
                return `Cause of death: Mechanical failure during a training exercise over Nevada, 1966. The Cold War claimed its pilots even in peacetime. Age ${1966 - birthYear}.`;
            }
            if (job === 'pilot' && nationality === 'soviet') {
                return `Cause of death: A classified incident along the Chinese border in 1969. The Soviet government notified your family only that you died "in service." Age ${1969 - birthYear}.`;
            }
            if (job === 'scientist' && nationality === 'soviet') {
                return `Cause of death: Radiation exposure accumulated over years in a closed nuclear research facility finally caught up with you. You passed in 1971, age ${1971 - birthYear}.`;
            }
            if (job === 'scientist' && nationality === 'american') {
                return `Cause of death: Heart attack in the lab, 1970. You worked yourself to death at the height of the arms race. Your research outlived you. Age ${1970 - birthYear}.`;
            }
            if (job === 'diplomat') {
                return `Cause of death: A blood clot during a transatlantic flight in 1972. Years of stress, alcohol, and sleepless negotiations had worn your body thin. Age ${1972 - birthYear}.`;
            }
            if (job === 'journalist' && nationality === 'soviet') {
                return `Cause of death: Disappeared in 1967 after publishing an article that strayed too close to the truth. You were never officially declared dead. Age ${1967 - birthYear}.`;
            }
            if (job === 'journalist') {
                return `Cause of death: Liver failure, 1973. You drank to cope with everything you'd seen and couldn't print. Age ${1973 - birthYear}.`;
            }

            // Nationality-based deaths
            if (nationality === 'cuban' && socialStatus === 'poor') {
                return `Cause of death: Malnutrition and untreated illness in 1970, as the embargo tightened its grip on everyday life. Age ${1970 - birthYear}.`;
            }
            if (nationality === 'soviet' && location === 'rural') {
                return `Cause of death: A harsh winter in 1968 and inadequate heating in your collective's housing. You were found frozen in the morning. Age ${1968 - birthYear}.`;
            }
            if (nationality === 'british') {
                return `Cause of death: Cancer, 1974. You lived long enough to see the Cold War settle into uneasy routine. The NHS did what it could. Age ${1974 - birthYear}.`;
            }

            // Generic fallbacks
            const generic = [
                `Cause of death: Heart failure in 1972. A lifetime of Cold War anxiety leaves marks the doctors call "stress-related." Age ${1972 - birthYear}.`,
                `Cause of death: A stroke in 1971, brought on by decades of fear, rationing, and uncertainty. You never did feel safe. Age ${1971 - birthYear}.`,
                `Cause of death: Cancer, 1970. Whether from atmospheric nuclear tests or just bad luck, you'll never know. Age ${1970 - birthYear}.`,
                `Cause of death: A traffic accident in 1969, the same year humans reached the Moon. The world advanced; you did not. Age ${1969 - birthYear}.`,
            ];
            return generic[Math.floor(Math.random() * generic.length)];
        }

        async function generateLife() {
            allTypingTimeouts.forEach(timeout => clearTimeout(timeout));
            allTypingTimeouts = [];
            characterChoices = {};

            const birthYear = parseInt(document.getElementById('birthYear').value);
            const nationality = document.getElementById('nationality').value;
            const job = document.getElementById('job').value;
            const socialStatus = document.getElementById('socialStatus').value;
            const location = document.getElementById('location').value;
            characterName = document.getElementById('characterName').value || 'Unknown';

            document.getElementById('formSection').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').innerHTML = '<div class="loading">Generating your Cold War life story</div>';
            
            await new Promise(resolve => setTimeout(resolve, 600));

            const summaryHtml = `
                <div class="character-summary">
                    <h2>${characterName}'s Cold War Life</h2>
                    <p>Born: ${birthYear} | Nationality: ${nationality.charAt(0).toUpperCase() + nationality.slice(1)} | 
                    Occupation: ${document.getElementById('job').options[document.getElementById('job').selectedIndex].text}</p>
                    <p>Social Status: ${document.getElementById('socialStatus').options[document.getElementById('socialStatus').selectedIndex].text}</p>
                </div>
            `;

            document.getElementById('results').innerHTML = summaryHtml;
            
            await new Promise(resolve => setTimeout(resolve, 50));
            document.querySelector('.character-summary').classList.add('visible');
            
            await new Promise(resolve => setTimeout(resolve, 300));

            const yearsToShow = [1957, 1961, 1962, 1963, 1968, 1969];
            for (const year of yearsToShow) {
                const age = year - birthYear;
                if (age < 0) continue;

                if (shouldShowDecision(year, age, nationality, job)) {
                    const decision = getDecisionPoint(year, age, nationality, job);
                    await createDecisionPoint(year, decision.prompt, decision.choices, document.getElementById('results'));
                    await pauseGeneration();
                }

                const lifeStory = generateYearStory(year, age, nationality, job, socialStatus, location);
                const hasSpecialEvent = hasSignificantEvent(year, age, nationality, job);
                const showHistory = shouldShowHistoricalContext(age, year, hasSpecialEvent);
                
                const entryDiv = document.createElement('div');
                entryDiv.className = 'timeline-entry';
                entryDiv.innerHTML = `
                    <div class="year-header">${year}</div>
                    <div class="age-info">${characterName}, Age: ${age}</div>
                    <div class="life-event"></div>
                    ${(showHistory && historicalEvents[year]) ? `<div class="historical-event"><strong>Historical Context:</strong> <span class="historical-text"></span></div>` : ''}
                `;
                
                document.getElementById('results').appendChild(entryDiv);
                scrollToLatest(entryDiv);
                
                await new Promise(resolve => setTimeout(resolve, 80));
                entryDiv.classList.add('visible');
                
                await new Promise(resolve => setTimeout(resolve, 150));
                
                const lifeEventElement = entryDiv.querySelector('.life-event');
                await typeText(lifeEventElement, lifeStory, 6);
                scrollToLatest(entryDiv);
                
                if (showHistory && historicalEvents[year]) {
                    await new Promise(resolve => setTimeout(resolve, 60));
                    const historicalDiv = entryDiv.querySelector('.historical-event');
                    historicalDiv.classList.add('visible');
                    
                    await new Promise(resolve => setTimeout(resolve, 80));
                    const historicalText = entryDiv.querySelector('.historical-text');
                    await typeText(historicalText, historicalEvents[year], 5);
                    scrollToLatest(historicalDiv);
                }
                
                await new Promise(resolve => setTimeout(resolve, 80));
            }

            await new Promise(resolve => setTimeout(resolve, 500));

            // Compute death reason based on accumulated choices
            const deathReason = getDeathReason(nationality, job, socialStatus, location, birthYear, characterChoices);
            
            const deathNotice = document.createElement('div');
            deathNotice.className = 'death-notice';
            deathNotice.style.cssText = `
                background: rgba(255, 0, 0, 0.15);
                border: 2px solid #ff6b6b;
                text-align: center;
                padding: 40px;
                margin-top: 30px;
                border-radius: 15px;
                opacity: 0;
                transition: opacity 0.8s ease-in-out;
            `;
            
            const deathText = document.createElement('h2');
            deathText.textContent = 'YOU ARE DEAD';
            deathText.style.cssText = `
                color: #ff6b6b;
                font-size: 3em;
                text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
                margin: 0;
                letter-spacing: 0.1em;
                animation: deathPulse 2s ease-in-out infinite;
            `;

            const deathReasonEl = document.createElement('p');
            deathReasonEl.className = 'death-reason';
            deathReasonEl.textContent = deathReason;
            
            deathNotice.appendChild(deathText);
            deathNotice.appendChild(deathReasonEl);
            document.getElementById('results').appendChild(deathNotice);
            
            if (!document.getElementById('deathPulseStyle')) {
                const style = document.createElement('style');
                style.id = 'deathPulseStyle';
                style.textContent = `
                    @keyframes deathPulse {
                        0%, 100% { 
                            opacity: 1;
                            transform: scale(1);
                        }
                        50% { 
                            opacity: 0.7;
                            transform: scale(1.05);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            await new Promise(resolve => setTimeout(resolve, 100));
            deathNotice.style.opacity = '1';
            scrollToLatest(deathNotice);

            await new Promise(resolve => setTimeout(resolve, 600));
            deathReasonEl.classList.add('visible');
            scrollToLatest(deathNotice);

            await new Promise(resolve => setTimeout(resolve, 800));

            const resetButton = document.createElement('button');
            resetButton.className = 'reset-btn';
            resetButton.textContent = 'Create Another Life';
            resetButton.onclick = resetSimulator;
            document.getElementById('results').appendChild(resetButton);
            
            await new Promise(resolve => setTimeout(resolve, 120));
            resetButton.classList.add('visible');
            scrollToLatest(resetButton);
        }

        function shouldShowDecision(year, age, nationality, job) {
            if (year === 1962 && age >= 18 && (job === 'pilot' || job === 'diplomat' || job === 'scientist')) return true;
            if (year === 1965 && age >= 18 && age <= 25 && nationality === 'american') return true;
            if (year === 1961 && age >= 16 && age <= 30 && nationality === 'cuban') return true;
            if (year === 1968 && age >= 18 && age <= 30) return true;
            return false;
        }

        function getDecisionPoint(year, age, nationality, job) {
            if (year === 1962 && job === 'pilot') {
                return {
                    prompt: `${characterName}, you're a military pilot during the Cuban Missile Crisis. Naval blockade orders arrive. What do you do?`,
                    choices: [
                        { text: 'Volunteer for high-risk reconnaissance flights over Cuba', value: 'volunteer_recon' },
                        { text: 'Request assignment to defensive patrols only', value: 'defensive' },
                        { text: 'Apply for temporary medical leave due to stress', value: 'medical_leave' }
                    ]
                };
            }
            
            if (year === 1962 && (job === 'diplomat' || job === 'scientist')) {
                return {
                    prompt: `The Cuban Missile Crisis reaches its peak. You have access to classified information. How do you respond?`,
                    choices: [
                        { text: 'Work overtime to help negotiate a peaceful resolution', value: 'peace_work' },
                        { text: 'Prepare your family for possible evacuation', value: 'family_prep' },
                        { text: 'Leak information to trusted journalists about the danger', value: 'leak' }
                    ]
                };
            }
            if (year === 1965 && nationality === 'american') {
                return {
                    prompt: `${characterName}, you're draft-eligible as U.S. involvement in Vietnam escalates. What do you do?`,
                    choices: [
                        { text: 'Enlist voluntarily to serve your country', value: 'enlist' },
                        { text: 'Apply for college deferment', value: 'deferment' },
                        { text: 'Consider leaving the country to avoid the draft', value: 'flee' },
                        { text: 'Declare yourself a conscientious objector', value: 'objector' }
                    ]
                };
            }

            if (year === 1961 && nationality === 'cuban') {
                return {
                    prompt: `Castro's government is consolidating power. Your neighbor is arrested for "counter-revolutionary activity." What do you do?`,
                    choices: [
                        { text: 'Report what you know to authorities to prove loyalty', value: 'report' },
                        { text: 'Stay silent and keep your head down', value: 'silent' },
                        { text: 'Secretly help the family and risk association', value: 'help' },
                        { text: 'Plan to leave Cuba by boat to Florida', value: 'escape' }
                    ]
                };
            }

            if (year === 1968) {
                return {
                    prompt: `1968 is a year of upheaval - assassinations, protests, and war. How do you respond to the chaos?`,
                    choices: [
                        { text: 'Join anti-war protests and demonstrations', value: 'protest' },
                        { text: 'Support the establishment and call for law and order', value: 'order' },
                        { text: 'Focus on your personal life and stay out of politics', value: 'apolitical' },
                        { text: 'Volunteer for political campaigns to create change', value: 'campaign' }
                    ]
                };
            }

            return null;
        }

        function generateYearStory(year, age, nationality, job, socialStatus, location) {
            const stories = [];

            if (age < 5) return `${characterName} is a young child, oblivious to geopolitical tensions. Your parents whisper anxiously about the "Cold War" but you're more interested in toys.`;
            
            if (age >= 5 && age < 12) {
                if (nationality === 'american') {
                    return `${characterName} practices duck-and-cover drills at school, hiding under desks and covering the back of their neck. Your teacher calls it protection from "the flash." You're not sure what that means, but you practice anyway.`;
                } else if (nationality === 'soviet') {
                    return `${characterName} learns from state primers about happy workers and Soviet superiority. You join the Young Pioneers and wear the red neckerchief with pride.`;
                } else if (nationality === 'cuban') {
                    return `${characterName} attends school in a country undergoing massive change. Some of your friends' parents have left for Miami; others celebrate the revolution.`;
                }
            }

            if (age >= 12 && age < 18) {
                if (nationality === 'american' && year >= 1962) {
                    return `${characterName} watches the Cuban Missile Crisis unfold on TV, terrified. Your mother stocks the basement with canned food; you wonder if you'll graduate high school.`;
                } else if (nationality === 'cuban') {
                    return `${characterName}'s family is divided between revolution supporters and exiles. You're unsure what to believe anymore.`;
                } else if (nationality === 'soviet') {
                    return `${characterName} studies math and science intensely, competing fiercely with classmates. Everyone wants to contribute to Soviet technological supremacy.`;
                }
            }

            if (year === 1962 && characterChoices[1962]) {
                if (characterChoices[1962] === 'volunteer_recon') {
                    return `${characterName} flies dangerous low-altitude reconnaissance missions over Cuban missile sites in an RF-8 Crusader. Cuban anti-aircraft gunners open fire on every pass. Your photos are crucial for White House decisions.`;
                } else if (characterChoices[1962] === 'defensive') {
                    return `${characterName} patrols the Florida Straits and Atlantic approaches, watching for Soviet vessels. Safer than flying over Cuba, though fellow pilots question your willingness to volunteer for the harder missions.`;
                } else if (characterChoices[1962] === 'medical_leave') {
                    return `${characterName} takes medical leave citing stress—many are breaking under the pressure. You spend October with family, grateful but guilt-ridden.`;
                } else if (characterChoices[1962] === 'peace_work') {
                    return `${characterName} works eighteen-hour days crafting diplomatic language to prevent nuclear war. You witness history being made in real-time.`;
                } else if (characterChoices[1962] === 'family_prep') {
                    return `${characterName} discreetly prepares your family to evacuate if needed. You've identified fallback locations and stockpiled supplies.`;
                } else if (characterChoices[1962] === 'leak') {
                    return `${characterName} leaks classified information to a trusted journalist about how close the world is to war. You believe the public deserves to know, despite the risk.`;
                }
            }

            if (year === 1966 && characterChoices[1965]) {
                if (characterChoices[1965] === 'enlist') {
                    return `${characterName} completes basic training and prepares for Vietnam deployment. You tell yourself you're serving a noble cause against communism.`;
                } else if (characterChoices[1965] === 'deferment') {
                    return `${characterName} continues college while friends ship out to Vietnam. You feel relief mixed with guilt watching the news reports.`;
                } else if (characterChoices[1965] === 'flee') {
                    return `${characterName} now lives in Canada, having crossed the border to avoid the draft. You can't go home without facing arrest.`;
                } else if (characterChoices[1965] === 'objector') {
                    return `${characterName} is granted conscientious objector status and performs two years of mandatory alternative civilian service. Some veterans regard you with contempt. You live with the tension of conviction and consequence.`;
                }
            }

            if (year === 1963 && characterChoices[1961] && nationality === 'cuban') {
                if (characterChoices[1961] === 'escape') {
                    return `${characterName} is now in Miami after a dangerous boat journey. You left everything behind, and life is hard—but you're free.`;
                } else if (characterChoices[1961] === 'help') {
                    return `${characterName} is under subtle surveillance after helping that arrested family. Opportunities have dried up; your family worries about your loyalty.`;
                } else if (characterChoices[1961] === 'report') {
                    return `${characterName} proved loyalty to the revolution, earning better housing and schools for your children. But you can't forget your neighbor's face.`;
                }
            }

            if (year === 1969 && characterChoices[1968]) {
                if (characterChoices[1968] === 'protest') {
                    return `${characterName} was arrested at a protest last year and now has a criminal record. The Moon landing feels bittersweet—humanity's achievement amid earthly injustice.`;
                } else if (characterChoices[1968] === 'campaign') {
                    return `${characterName} worked on political campaigns that lost, learning how the system works. You watch Armstrong walk on the Moon with cautious hope.`;
                }
            }

            if (year === 1957 && job === 'engineer') {
                return nationality === 'soviet' ? 
                    `${characterName} helped build Sputnik. Hearing its beep on the radio brings tears to your eyes—the Soviet Union achieved the impossible.` :
                    `${characterName} arrives at work to devastating news: the Soviets launched a satellite first. Congress opens hearings within weeks; a flood of new funding follows. Within a year, NASA exists. The race is on.`;
            }

            if (year === 1961 && job === 'pilot' && !characterChoices[1962]) {
                return nationality === 'american' ?
                    `${characterName} watches Gagarin orbit Earth with frustration. You drill harder, determined to be part of America's catch-up.` :
                    `${characterName} follows Gagarin's mission on the radio with immense national pride. You trained at similar facilities; cosmonaut selection was always possible for the best pilots, but the program is secret and competitive beyond imagination.`;
            }

            if (year === 1963 && nationality === 'american') {
                return age >= 12 ?
                    `${characterName} remembers exactly where you were when Kennedy was assassinated. School let out early; the whole country feels shot.` :
                    `${characterName}'s parents can't stop crying watching TV. You don't understand death yet, but you know something terrible happened.`;
            }

            if (year === 1969 && job === 'engineer') {
                return nationality === 'american' ?
                    `${characterName} watches Armstrong step onto the Moon with overwhelming emotion. All those late nights and calculations led to this—America won.` :
                    `${characterName} watches the American Moon landing with mixed feelings. Your country was first in space, but they reached the Moon first.`;
            }

            if (age >= 18 && !characterChoices[year]) {
                const jobStories = {
                    engineer: nationality === 'american' ? 
                        `${characterName} works on classified aerospace projects you can't discuss. Every calculation could mean victory or defeat in the technological race.` :
                        `${characterName} serves the Soviet state as an engineer with limited resources. The sense of purpose is real, building the future.`,
                    scientist: nationality === 'american' ?
                        `${characterName} conducts research blurring civilian and military science, all classified. You have nightmares but tell yourself it's necessary for security.` :
                        `${characterName} works in a closed research city with monitored mail. You can't travel freely, but the cutting-edge physics rivals the West.`,
                    pilot: nationality === 'american' ?
                        `${characterName} maintains constant readiness to intercept Soviet aircraft probing American airspace. The Cold War isn't cold in the cockpit.` :
                        `${characterName} flies patrols along socialist borders, vigilant against American probing. You've come close to firing, but never crossed the line.`,
                    diplomat: `${characterName} navigates impossible negotiations where every word could escalate into catastrophe. You drink too much and sleep too little.`,
                    factory: socialStatus === 'working' ?
                        `${characterName} works long shifts at a defense contractor with decent pay but repetitive work. Management gets rich while you get by.` :
                        `${characterName} manages production quotas at a defense factory. Meeting targets means bonuses; missing them brings trouble.`,
                    teacher: nationality === 'american' ?
                        `${characterName} teaches students to hide under desks while presenting optimistic futures. The cognitive dissonance is exhausting.` :
                        `${characterName} teaches the state-mandated curriculum with little room for independent thought. You find subtle ways to inspire curiosity.`,
                    journalist: nationality === 'american' ?
                        `${characterName} reports on Cold War developments while navigating pressure from editors and government. What serves the public vs. national security?` :
                        `${characterName} writes for the state press, learning to hide subtle truths between propaganda lines. A few readers understand.`,
                    farmer: `${characterName} works the land while superpowers threaten to destroy it. You just want to grow food and be left alone.`
                };

                return jobStories[job] || `${characterName} navigates daily life under constant threat of nuclear annihilation. It becomes almost normal.`;
            }

            return stories.join(' ') || `${characterName} continues living under the shadow of the Cold War.`;
        }

        function resetSimulator() {
            allTypingTimeouts.forEach(timeout => clearTimeout(timeout));
            allTypingTimeouts = [];
            characterChoices = {};
            generationPaused = false;
            document.getElementById('formSection').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('results').innerHTML = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
